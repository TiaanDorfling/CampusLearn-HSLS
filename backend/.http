# ============================================================================
# CampusLearn Backend API – COMPLETE Test Suite
# Updated: 2025-10-22  (matches current backend)
# Requires: server running at http://127.0.0.1:5000
# Notes:
#  - This suite uses cookie-based auth (jwt cookie). Each login captures a cookie
#    into a variable for subsequent calls.
#  - Domains enforced:
#       student  → @student.belgiumcampus.ac.za
#       tutor/admin → @belgiumcampus.ac.za
# ============================================================================

@host = http://127.0.0.1:5000
@base = {{host}}/api
@ct = application/json

### --------------------------------------------------------------------------
### 0. Health & Diagnostics
### --------------------------------------------------------------------------

GET {{host}}/healthz

###
GET {{base}}/health

###
GET {{base}}/index
### (if you want to see env keys)
GET {{base}}/health/env-keys

### --------------------------------------------------------------------------
### 1. AUTH
### --------------------------------------------------------------------------

# Register Student
POST {{base}}/auth/register
Content-Type: {{ct}}

{
  "name": "Alice Student",
  "email": "alice.student@student.belgiumcampus.ac.za",
  "password": "Password123!",
  "role": "student"
}

###

# Register Tutor
POST {{base}}/auth/register
Content-Type: {{ct}}

{
  "name": "John Doe",
  "email": "john.doe@belgiumcampus.ac.za",
  "password": "Password123!",
  "role": "tutor"
}

###

# Register Admin
POST {{base}}/auth/register
Content-Type: {{ct}}

{
  "name": "Jane Admin",
  "email": "jane@admin.campuslearn.ac.za",
  "password": "Password123!",
  "role": "admin"
}

###

# Login Student
POST {{base}}/auth/login
Content-Type: {{ct}}

{
  "email": "alice.student@student.belgiumcampus.ac.za",
  "password": "Password123!"
}

###

# Login Tutor
POST {{base}}/auth/login
Content-Type: {{ct}}

{
  "email": "bob.tutor@belgiumcampus.ac.za",
  "password": "Password123!"
}

###

# Login Admin
POST {{base}}/auth/login
Content-Type: {{ct}}

{
  "email": "cara.admin@belgiumcampus.ac.za",
  "password": "Password123!"
}

###

# Validate Session (student)
GET {{base}}/auth/session
Cookie: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2OGY4OTY5ODM1MzkyNzE3Y2EyYjVkMTMiLCJyb2xlIjoic3R1ZGVudCIsImlhdCI6MTc2MTEyMjAyMSwiZXhwIjoxNzYxMTI1NjIxfQ.0S1F8VTDzRaG4wPkbvu8m3O07S55CTjd-p6hhpo7ovA

###

# Logout (student)
POST {{base}}/auth/logout
Cookie: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2OGY4OTY5ODM1MzkyNzE3Y2EyYjVkMTMiLCJyb2xlIjoic3R1ZGVudCIsImlhdCI6MTc2MTEyMjAyMSwiZXhwIjoxNzYxMTI1NjIxfQ.0S1F8VTDzRaG4wPkbvu8m3O07S55CTjd-p6hhpo7ovA

### --------------------------------------------------------------------------
### 2. USERS (read-only list for now; admin management via /api/admin)
### --------------------------------------------------------------------------

# List users (public read; your /api/users uses auth(false))
GET {{base}}/users?limit=50

### --------------------------------------------------------------------------
### 3. STUDENT PROFILE
### --------------------------------------------------------------------------

# Create/Update my student profile
PUT {{base}}/student/me
Cookie: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2OGY4OTY5ODM1MzkyNzE3Y2EyYjVkMTMiLCJyb2xlIjoic3R1ZGVudCIsImlhdCI6MTc2MTEyMjAyMSwiZXhwIjoxNzYxMTI1NjIxfQ.0S1F8VTDzRaG4wPkbvu8m3O07S55CTjd-p6hhpo7ovA
Content-Type: application/json

{
  "studentNumber": "S1002003",
  "year": "3",
  "phone": "0123456789",
  "about": "Enjoys databases and web dev",
  "emergencyContact": { "name": "Parent", "phone": "0987654321" }
}

###

# Get my student profile
GET {{base}}/student/me
Cookie: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2OGY4OTY5ODM1MzkyNzE3Y2EyYjVkMTMiLCJyb2xlIjoic3R1ZGVudCIsImlhdCI6MTc2MTEyMjAyMSwiZXhwIjoxNzYxMTI1NjIxfQ.0S1F8VTDzRaG4wPkbvu8m3O07S55CTjd-p6hhpo7ovA

### --------------------------------------------------------------------------
### 4. TUTOR PROFILE + STUDENTS LIST
### --------------------------------------------------------------------------

# Create/Update my tutor profile
PUT {{base}}/tutor/me
Cookie: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2OGY4OTY5ZDM1MzkyNzE3Y2EyYjVkMTYiLCJyb2xlIjoidHV0b3IiLCJpYXQiOjE3NjExMjI1NzMsImV4cCI6MTc2MTEyNjE3M30.scVcjpq6ooOOMnKvmAgRAShb4Tamuu2HeisfLqKlrRk
Content-Type: {{ct}}

{
  "bio": "Web and DB tutor",
  "phone": "0212345678",
  "assignedModules": ["SEN381", "DBS200"],
  "tutorTopics": ["React", "MongoDB"]
}

###

# Get my tutor profile
GET {{base}}/tutor/me
Cookie: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2OGY4OTY5ZDM1MzkyNzE3Y2EyYjVkMTYiLCJyb2xlIjoidHV0b3IiLCJpYXQiOjE3NjExMjI1NzMsImV4cCI6MTc2MTEyNjE3M30.scVcjpq6ooOOMnKvmAgRAShb4Tamuu2HeisfLqKlrRk

###

# List students for a tutor (replace {{tutorId}} with _id from previous call)
GET {{base}}/tutor/68f89931d87ae1274c6d1874/students?page=1&q=
Cookie: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2OGY4OTY5ZDM1MzkyNzE3Y2EyYjVkMTYiLCJyb2xlIjoidHV0b3IiLCJpYXQiOjE3NjExMjI1NzMsImV4cCI6MTc2MTEyNjE3M30.scVcjpq6ooOOMnKvmAgRAShb4Tamuu2HeisfLqKlrRk

### --------------------------------------------------------------------------
### 5. TOPICS
### --------------------------------------------------------------------------

# Create topic (any logged-in user; you can restrict later)
POST {{base}}/topics
Cookie: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2OGY4OTY5ZDM1MzkyNzE3Y2EyYjVkMTYiLCJyb2xlIjoidHV0b3IiLCJpYXQiOjE3NjExMjI1NzMsImV4cCI6MTc2MTEyNjE3M30.scVcjpq6ooOOMnKvmAgRAShb4Tamuu2HeisfLqKlrRk
Content-Type: {{ct}}

{
  "title": "SEN381 – Software Engineering",
  "description": "Questions, resources, and announcements for SEN381.",
  "moduleCode": "SEN381",
  "tags": ["engineering", "design"]
}

###

# List topics
GET {{base}}/topics
Cookie: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2OGY4OTY5ODM1MzkyNzE3Y2EyYjVkMTMiLCJyb2xlIjoic3R1ZGVudCIsImlhdCI6MTc2MTEyMjAyMSwiZXhwIjoxNzYxMTI1NjIxfQ.0S1F8VTDzRaG4wPkbvu8m3O07S55CTjd-p6hhpo7ovA

###

# Subscribe to a topic (replace {{topicId}})
POST {{base}}/topics/68f401516e1bb3dd5e43cd3a/subscribe
Cookie: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2OGY4OTY5ODM1MzkyNzE3Y2EyYjVkMTMiLCJyb2xlIjoic3R1ZGVudCIsImlhdCI6MTc2MTEyMjAyMSwiZXhwIjoxNzYxMTI1NjIxfQ.0S1F8VTDzRaG4wPkbvu8m3O07S55CTjd-p6hhpo7ovA

###

# Unsubscribe
DELETE {{base}}/topics/68f401516e1bb3dd5e43cd3a/unsubscribe
Cookie: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2OGY4OTY5ODM1MzkyNzE3Y2EyYjVkMTMiLCJyb2xlIjoic3R1ZGVudCIsImlhdCI6MTc2MTEyMjAyMSwiZXhwIjoxNzYxMTI1NjIxfQ.0S1F8VTDzRaG4wPkbvu8m3O07S55CTjd-p6hhpo7ovA

###

# Upload resource to topic (replace {{topicId}})
# Requires an existing file at ./uploads/sample.pdf (relative to this .http)
POST {{base}}/topics/68f401516e1bb3dd5e43cd3a/resource
Cookie: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2OGY4OTY5ZDM1MzkyNzE3Y2EyYjVkMTYiLCJyb2xlIjoidHV0b3IiLCJpYXQiOjE3NjExMjI1NzMsImV4cCI6MTc2MTEyNjE3M30.scVcjpq6ooOOMnKvmAgRAShb4Tamuu2HeisfLqKlrRk
Content-Type: multipart/form-data; boundary=Boundary
--Boundary
Content-Disposition: form-data; name="resourceFile"; filename="sample.pdf"
Content-Type: application/pdf

< ./uploads/Notes.pdf >

###

# Broadcast announcement on a topic
POST {{base}}/topics/68f401516e1bb3dd5e43cd3a/broadcast
Cookie: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2OGY4OTY5ZDM1MzkyNzE3Y2EyYjVkMTYiLCJyb2xlIjoidHV0b3IiLCJpYXQiOjE3NjExMjI1NzMsImV4cCI6MTc2MTEyNjE3M30.scVcjpq6ooOOMnKvmAgRAShb4Tamuu2HeisfLqKlrRk
Content-Type: {{ct}}

{
  "message": "Reminder: Project milestone due Friday."
}

### --------------------------------------------------------------------------
### 6. FORUM (categories, threads, posts)
### --------------------------------------------------------------------------

# Create Forum Category
POST {{base}}/forum/categories
Cookie: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2OGY4OTNmZmFjMTU3OWI1Y2FkYjUzZTIiLCJyb2xlIjoiYWRtaW4iLCJpYXQiOjE3NjExMjI4MzUsImV4cCI6MTc2MTEyNjQzNX0.Wm_0v_d0AohB7b0BUxCt8FEvXdESj3VXIjMgxXokUl4
Content-Type: {{ct}}

{
  "name": "General",
  "description": "General campus discussion"
}

###

# List Categories
GET {{base}}/forum/categories

###

# Create Thread (use categoryId)
POST {{base}}/forum/threads
Cookie: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2OGY4OTY5ODM1MzkyNzE3Y2EyYjVkMTMiLCJyb2xlIjoic3R1ZGVudCIsImlhdCI6MTc2MTEyMjAyMSwiZXhwIjoxNzYxMTI1NjIxfQ.0S1F8VTDzRaG4wPkbvu8m3O07S55CTjd-p6hhpo7ovA
Content-Type: {{ct}}

{
  "categoryId": "68f89a2935392717ca2b5d55",
  "title": "Help with recursion"
}

###

# List Threads (optionally by category)
GET {{base}}/forum/threads?category=68f89a2935392717ca2b5d55

###

# Create Post (use threadId)
POST {{base}}/forum/posts
Cookie: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2OGY4OTY5ODM1MzkyNzE3Y2EyYjVkMTMiLCJyb2xlIjoic3R1ZGVudCIsImlhdCI6MTc2MTEyMjAyMSwiZXhwIjoxNzYxMTI1NjIxfQ.0S1F8VTDzRaG4wPkbvu8m3O07S55CTjd-p6hhpo7ovA
Content-Type: {{ct}}

{
  "threadId": "68f89a4035392717ca2b5d57",
  "content": "Can someone explain base cases?"
}

###

# List Posts in thread
GET {{base}}/forum/posts?thread=68f89a4035392717ca2b5d57

### --------------------------------------------------------------------------
### 7. PRIVATE MESSAGES (DM via /api/pm)
### --------------------------------------------------------------------------

# Send DM (student → tutor)
POST {{base}}/pm
Cookie: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2OGY4OTY5ODM1MzkyNzE3Y2EyYjVkMTMiLCJyb2xlIjoic3R1ZGVudCIsImlhdCI6MTc2MTEyNjg4MywiZXhwIjoxNzYxMTMwNDgzfQ.w3Pj8ia7oUPam6t5MK3xqZCBxBytRaFteyBVDvyGZso
Content-Type: {{ct}}

{
  "toUserId": "68f8969d35392717ca2b5d16",
  "subject": "Software Problems",
  "body": "I am having problems understanding software design patterns. Can you help me please?"
}

###

# Get my DMs (student)
GET {{base}}/pm
Cookie: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2OGY4OTY5ZDM1MzkyNzE3Y2EyYjVkMTYiLCJyb2xlIjoidHV0b3IiLCJpYXQiOjE3NjExMjU1ODQsImV4cCI6MTc2MTEyOTE4NH0.anw_qRwOiJX-7oa79Dlhof9oqJYvOp_C7wE7Z2Da7X0

###

# Mark a DM as read (message id)
PATCH {{base}}/pm/68f8987035392717ca2b5d3a/read
Cookie: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2OGY4OTY5ODM1MzkyNzE3Y2EyYjVkMTMiLCJyb2xlIjoic3R1ZGVudCIsImlhdCI6MTc2MTEyMjAyMSwiZXhwIjoxNzYxMTI1NjIxfQ.0S1F8VTDzRaG4wPkbvu8m3O07S55CTjd-p6hhpo7ovA

### --------------------------------------------------------------------------
### 8. QUESTIONS & RESPONSES
### --------------------------------------------------------------------------

# Ask a question (student)
POST {{base}}/questions
Cookie: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2OGY4OTY5ODM1MzkyNzE3Y2EyYjVkMTMiLCJyb2xlIjoic3R1ZGVudCIsImlhdCI6MTc2MTEyMjk5OSwiZXhwIjoxNzYxMTI2NTk5fQ.99ewMa_dQ3BJEjodibE2TIZ9QR04Ece07UsUKB8vv14
Content-Type: application/json

{
  "title": "Clarification on recursion",
  "body": "Can a recursive call occur after a loop?",
  "moduleCode": "SEN381"
}

###

# Tutor responds (use questionId)
POST {{base}}/questions/68f89acd35392717ca2b5d61/response
Cookie: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2OGY4OTY5ZDM1MzkyNzE3Y2EyYjVkMTYiLCJyb2xlIjoidHV0b3IiLCJpYXQiOjE3NjExMjI1NzMsImV4cCI6MTc2MTEyNjE3M30.scVcjpq6ooOOMnKvmAgRAShb4Tamuu2HeisfLqKlrRk
Content-Type: {{ct}}

{
  "content": "Yes, but ensure your base case will be reached.",
  "isAnonymous": false
}

###

# Get responses for a question
GET {{base}}/questions/68f89acd35392717ca2b5d61/responses
Cookie: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2OGY4OTY5ODM1MzkyNzE3Y2EyYjVkMTMiLCJyb2xlIjoic3R1ZGVudCIsImlhdCI6MTc2MTEyMjk5OSwiZXhwIjoxNzYxMTI2NTk5fQ.99ewMa_dQ3BJEjodibE2TIZ9QR04Ece07UsUKB8vv14

###

# List all questions
GET {{base}}/questions

### --------------------------------------------------------------------------
### 9. AI (Simulated)
### --------------------------------------------------------------------------

POST {{base}}/ai/chat
Cookie: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2OGY4OTY5ODM1MzkyNzE3Y2EyYjVkMTMiLCJyb2xlIjoic3R1ZGVudCIsImlhdCI6MTc2MTEyMjAyMSwiZXhwIjoxNzYxMTI1NjIxfQ.0S1F8VTDzRaG4wPkbvu8m3O07S55CTjd-p6hhpo7ovA
Content-Type: application/json

{
  "prompt": "Explain JWT briefly"
}

### --------------------------------------------------------------------------
### 10. NOTIFICATIONS
### --------------------------------------------------------------------------

# List my notifications
GET {{base}}/notifications
Cookie: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2OGY4OTY5ZDM1MzkyNzE3Y2EyYjVkMTYiLCJyb2xlIjoidHV0b3IiLCJpYXQiOjE3NjExMjY5NDQsImV4cCI6MTc2MTEzMDU0NH0.JQqxWBTlB_IvpSG69hyvVmt_SI7orQHjB7-JpfQHtW8

###

# Mark read (use notifId)
PATCH {{base}}/notifications/68f8a9fa2e384b3d56807804/read
Cookie: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2OGY4OTY5ZDM1MzkyNzE3Y2EyYjVkMTYiLCJyb2xlIjoidHV0b3IiLCJpYXQiOjE3NjExMjY5NDQsImV4cCI6MTc2MTEzMDU0NH0.JQqxWBTlB_IvpSG69hyvVmt_SI7orQHjB7-JpfQHtW8

###

# Delete notification
DELETE {{base}}/notifications/{{notifId}}
Cookie: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2OGY4OTY5ODM1MzkyNzE3Y2EyYjVkMTMiLCJyb2xlIjoic3R1ZGVudCIsImlhdCI6MTc2MTEyMjAyMSwiZXhwIjoxNzYxMTI1NjIxfQ.0S1F8VTDzRaG4wPkbvu8m3O07S55CTjd-p6hhpo7ovA

### --------------------------------------------------------------------------
### 11. ADMIN
### --------------------------------------------------------------------------

# List users (admin panel)
GET {{base}}/admin/users
Cookie: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2OGY4OTNmZmFjMTU3OWI1Y2FkYjUzZTIiLCJyb2xlIjoiYWRtaW4iLCJpYXQiOjE3NjExMjI4MzUsImV4cCI6MTc2MTEyNjQzNX0.Wm_0v_d0AohB7b0BUxCt8FEvXdESj3VXIjMgxXokUl4

###

# Update user role (admin) – set to tutor/student/admin
PATCH {{base}}/admin/users/{{userId}}/role
Cookie: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2OGY4OTNmZmFjMTU3OWI1Y2FkYjUzZTIiLCJyb2xlIjoiYWRtaW4iLCJpYXQiOjE3NjExMjI4MzUsImV4cCI6MTc2MTEyNjQzNX0.Wm_0v_d0AohB7b0BUxCt8FEvXdESj3VXIjMgxXokUl4
Content-Type: {{ct}}

{
  "role": "tutor"
}

###

# Delete user (admin)
DELETE {{base}}/admin/users/{{userId}}
Cookie: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2OGY4OTNmZmFjMTU3OWI1Y2FkYjUzZTIiLCJyb2xlIjoiYWRtaW4iLCJpYXQiOjE3NjExMjI4MzUsImV4cCI6MTc2MTEyNjQzNX0.Wm_0v_d0AohB7b0BUxCt8FEvXdESj3VXIjMgxXokUl4
